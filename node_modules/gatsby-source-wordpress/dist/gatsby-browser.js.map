{"version":3,"file":"gatsby-browser.js","names":["React","hydrateRef","onRouteUpdate","window","cancelIdleCallback","requestIdleCallback","hydrateImages","clearTimeout","setTimeout","ReactDOM","HAS_REACT_18","require","doc","document","inlineWPimages","Array","from","querySelectorAll","length","then","mod","forEach","image","grandParentIsGatsbyImage","parentNode","classList","contains","parentIsGatsbyImage","gatsbyImageHydrationElement","dataset","wpInlineImage","hydrationData","querySelector","imageProps","JSON","parse","innerHTML","createRoot","root","render","createElement","GatsbyImage","hydrate"],"sources":["../src/gatsby-browser.ts"],"sourcesContent":["/* global HAS_REACT_18 */\nimport type { GatsbyImageProps } from \"gatsby-plugin-image\"\nimport React from \"react\"\n\nlet hydrateRef\n\nexport function onRouteUpdate(): void {\n  if (`requestIdleCallback` in window) {\n    if (hydrateRef) {\n      // @ts-ignore cancelIdleCallback is on window object\n      cancelIdleCallback(hydrateRef)\n    }\n\n    // @ts-ignore requestIdleCallback is on window object\n    hydrateRef = requestIdleCallback(hydrateImages)\n  } else {\n    if (hydrateRef) {\n      clearTimeout(hydrateRef)\n    }\n    hydrateRef = setTimeout(hydrateImages)\n  }\n}\n\ndeclare const HAS_REACT_18: boolean\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet ReactDOM: any\n\nif (HAS_REACT_18) {\n  ReactDOM = require(`react-dom/client`)\n} else {\n  ReactDOM = require(`react-dom`)\n}\n\nfunction hydrateImages(): void {\n  const doc = document\n  const inlineWPimages: Array<HTMLElement> = Array.from(\n    doc.querySelectorAll(`[data-wp-inline-image]`)\n  )\n\n  if (!inlineWPimages.length) {\n    return\n  }\n\n  import(\n    /* webpackChunkName: \"gatsby-plugin-image\" */ `gatsby-plugin-image`\n  ).then(mod => {\n    inlineWPimages.forEach(image => {\n      // usually this is the right element to hydrate on\n      const grandParentIsGatsbyImage =\n        // @ts-ignore-next-line classList is on HTMLElement\n        image?.parentNode?.parentNode?.classList?.contains(\n          `gatsby-image-wrapper`\n        )\n\n      // but sometimes this is the right element\n      const parentIsGatsbyImage =\n        // @ts-ignore-next-line classList is on HTMLElement\n        image?.parentNode?.classList?.contains(`gatsby-image-wrapper`)\n\n      if (!grandParentIsGatsbyImage && !parentIsGatsbyImage) {\n        return\n      }\n\n      const gatsbyImageHydrationElement = grandParentIsGatsbyImage\n        ? image.parentNode.parentNode\n        : image.parentNode\n\n      if (\n        image.dataset &&\n        image.dataset.wpInlineImage &&\n        gatsbyImageHydrationElement\n      ) {\n        const hydrationData = doc.querySelector(\n          `script[data-wp-inline-image-hydration=\"${image.dataset.wpInlineImage}\"]`\n        )\n\n        if (hydrationData) {\n          const imageProps: GatsbyImageProps = JSON.parse(\n            hydrationData.innerHTML\n          )\n\n          if (ReactDOM.createRoot) {\n            const root = ReactDOM.createRoot(gatsbyImageHydrationElement)\n            root.render(React.createElement(mod.GatsbyImage, imageProps))\n          } else {\n            ReactDOM.hydrate(\n              React.createElement(mod.GatsbyImage, imageProps),\n              gatsbyImageHydrationElement\n            )\n          }\n        }\n      }\n    })\n  })\n}\n"],"mappings":"AAAA;AAEA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,IAAIC,UAAJ;AAEA,OAAO,SAASC,aAAT,GAA+B;EACpC,IAAK,qBAAD,IAAyBC,MAA7B,EAAqC;IACnC,IAAIF,UAAJ,EAAgB;MACd;MACAG,kBAAkB,CAACH,UAAD,CAAlB;IACD,CAJkC,CAMnC;;;IACAA,UAAU,GAAGI,mBAAmB,CAACC,aAAD,CAAhC;EACD,CARD,MAQO;IACL,IAAIL,UAAJ,EAAgB;MACdM,YAAY,CAACN,UAAD,CAAZ;IACD;;IACDA,UAAU,GAAGO,UAAU,CAACF,aAAD,CAAvB;EACD;AACF;AAID;AACA,IAAIG,QAAJ;;AAEA,IAAIC,YAAJ,EAAkB;EAChBD,QAAQ,GAAGE,OAAO,CAAE,kBAAF,CAAlB;AACD,CAFD,MAEO;EACLF,QAAQ,GAAGE,OAAO,CAAE,WAAF,CAAlB;AACD;;AAED,SAASL,aAAT,GAA+B;EAC7B,MAAMM,GAAG,GAAGC,QAAZ;EACA,MAAMC,cAAkC,GAAGC,KAAK,CAACC,IAAN,CACzCJ,GAAG,CAACK,gBAAJ,CAAsB,wBAAtB,CADyC,CAA3C;;EAIA,IAAI,CAACH,cAAc,CAACI,MAApB,EAA4B;IAC1B;EACD;;EAED;EACE;EAA+C,qBADjD,EAEEC,IAFF,CAEOC,GAAG,IAAI;IACZN,cAAc,CAACO,OAAf,CAAuBC,KAAK,IAAI;MAAA;;MAC9B;MACA,MAAMC,wBAAwB,GAC5B;MACAD,KAF4B,aAE5BA,KAF4B,4CAE5BA,KAAK,CAAEE,UAFqB,+EAE5B,kBAAmBA,UAFS,oFAE5B,sBAA+BC,SAFH,2DAE5B,uBAA0CC,QAA1C,CACG,sBADH,CAFF,CAF8B,CAQ9B;;MACA,MAAMC,mBAAmB,GACvB;MACAL,KAFuB,aAEvBA,KAFuB,6CAEvBA,KAAK,CAAEE,UAFgB,gFAEvB,mBAAmBC,SAFI,0DAEvB,sBAA8BC,QAA9B,CAAwC,sBAAxC,CAFF;;MAIA,IAAI,CAACH,wBAAD,IAA6B,CAACI,mBAAlC,EAAuD;QACrD;MACD;;MAED,MAAMC,2BAA2B,GAAGL,wBAAwB,GACxDD,KAAK,CAACE,UAAN,CAAiBA,UADuC,GAExDF,KAAK,CAACE,UAFV;;MAIA,IACEF,KAAK,CAACO,OAAN,IACAP,KAAK,CAACO,OAAN,CAAcC,aADd,IAEAF,2BAHF,EAIE;QACA,MAAMG,aAAa,GAAGnB,GAAG,CAACoB,aAAJ,CACnB,0CAAyCV,KAAK,CAACO,OAAN,CAAcC,aAAc,IADlD,CAAtB;;QAIA,IAAIC,aAAJ,EAAmB;UACjB,MAAME,UAA4B,GAAGC,IAAI,CAACC,KAAL,CACnCJ,aAAa,CAACK,SADqB,CAArC;;UAIA,IAAI3B,QAAQ,CAAC4B,UAAb,EAAyB;YACvB,MAAMC,IAAI,GAAG7B,QAAQ,CAAC4B,UAAT,CAAoBT,2BAApB,CAAb;YACAU,IAAI,CAACC,MAAL,eAAYvC,KAAK,CAACwC,aAAN,CAAoBpB,GAAG,CAACqB,WAAxB,EAAqCR,UAArC,CAAZ;UACD,CAHD,MAGO;YACLxB,QAAQ,CAACiC,OAAT,eACE1C,KAAK,CAACwC,aAAN,CAAoBpB,GAAG,CAACqB,WAAxB,EAAqCR,UAArC,CADF,EAEEL,2BAFF;UAID;QACF;MACF;IACF,CA9CD;EA+CD,CAlDD;AAmDD"}